<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LinkedIn Post Rater ‚Äî EF Edition</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #fff; font-family: 'Syne', sans-serif; color: #0f172a; min-height: 100vh; }
textarea, input, select { font-family: 'DM Mono', monospace; font-size: 13px; outline: none; transition: border-color 0.15s, box-shadow 0.15s; }
textarea:focus, input:focus, select:focus { border-color: #0077b5 !important; box-shadow: 0 0 0 3px rgba(0,119,181,0.1) !important; }
textarea { resize: vertical; }
@keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
@keyframes spin { to { transform: rotate(360deg); } }
.fade-up { animation: fadeUp 0.3s ease; }
.spinner { width:15px; height:15px; border:2px solid rgba(255,255,255,0.3); border-top-color:white; border-radius:50%; animation: spin 0.7s linear infinite; display:inline-block; vertical-align:middle; margin-right:8px; }

#app { max-width: 780px; margin: 0 auto; padding: 2rem 1.25rem 5rem; }

.header { display:flex; align-items:center; gap:10px; margin-bottom:2rem; padding-bottom:1.25rem; border-bottom:1px solid #e5e7eb; }
.header-logo { width:34px; height:34px; background:#0077b5; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:14px; color:white; flex-shrink:0; }
.header-title { font-weight:700; font-size:15px; letter-spacing:-0.3px; }
.header-sub { font-family:'DM Mono',monospace; font-size:11px; color:#9ca3af; margin-top:1px; }
.header-badge { margin-left:auto; background:#e8f4fb; border:1px solid rgba(0,119,181,0.2); color:#0077b5; font-family:'DM Mono',monospace; font-size:10px; padding:3px 10px; border-radius:20px; }

.lbl { font-family:'DM Mono',monospace; font-size:10px; text-transform:uppercase; letter-spacing:1px; color:#9ca3af; margin-bottom:6px; }

.card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:1.1rem 1.25rem; margin-bottom:10px; }
.card-title { font-family:'DM Mono',monospace; font-size:10px; text-transform:uppercase; letter-spacing:1px; color:#9ca3af; display:flex; align-items:center; gap:5px; margin-bottom:12px; }

.tag { font-family:'DM Mono',monospace; display:inline-flex; align-items:center; padding:3px 10px; border-radius:20px; font-size:11px; margin:2px 3px 2px 0; }
.tag-blue { background:#e8f4fb; color:#0077b5; border:1px solid rgba(0,119,181,0.2); }

.divider { display:flex; align-items:center; gap:10px; margin:16px 0 10px; }
.divider span { font-family:'DM Mono',monospace; font-size:10px; text-transform:uppercase; letter-spacing:1.5px; color:#9ca3af; white-space:nowrap; }
.divider hr { flex:1; border:none; border-top:1px solid #e5e7eb; }

.post-box { border:1px solid #e5e7eb; border-radius:11px; padding:1.1rem 1.25rem; margin-bottom:10px; transition:border-color 0.15s; }
.post-box:focus-within { border-color:#0077b5; }
.post-textarea { width:100%; background:transparent; border:none; outline:none; color:#0f172a; font-size:13.5px; line-height:1.7; min-height:160px; }
.char-count { text-align:right; font-family:'DM Mono',monospace; font-size:10px; margin-top:4px; }

.drop-zone { border:1.5px dashed #d1d5db; border-radius:10px; padding:1.1rem 1.25rem; margin-bottom:10px; text-align:center; cursor:pointer; transition:all 0.15s; background:#f8f9fa; }
.drop-zone.drag-over { border-color:#0077b5; background:#e8f4fb; }

.accordion { border:1px solid #e5e7eb; border-radius:10px; margin-bottom:10px; overflow:hidden; background:#f8f9fa; }
.acc-header { padding:12px 16px; cursor:pointer; display:flex; align-items:center; gap:8px; font-family:'DM Mono',monospace; font-size:12px; color:#374151; user-select:none; }
.acc-body { border-top:1px solid #e5e7eb; padding:14px 16px; background:#fff; display:none; }
.acc-body.open { display:block; }
.acc-arrow { margin-left:auto; color:#9ca3af; font-size:10px; transition:transform 0.2s; display:inline-block; }
.acc-arrow.open { transform:rotate(180deg); }
.grid2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px; }

.input-field { background:#fff; border:1px solid #e5e7eb; border-radius:7px; color:#0f172a; padding:8px 11px; width:100%; -webkit-appearance:none; }

.error-box { background:#fef2f2; border:1px solid #fecaca; border-radius:8px; padding:10px 14px; color:#dc2626; font-family:'DM Mono',monospace; font-size:12px; margin-bottom:12px; display:none; }

.btn-analyze { width:100%; padding:13px; background:#0f172a; border:none; border-radius:10px; color:white; font-family:'Syne',sans-serif; font-size:14px; font-weight:700; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:2rem; letter-spacing:0.2px; transition:background 0.15s; }
.btn-analyze:disabled { background:#374151; cursor:not-allowed; opacity:0.8; }
.btn-analyze:hover:not(:disabled) { background:#1e293b; }

.verdict-header { display:flex; align-items:flex-end; gap:20px; margin-bottom:12px; flex-wrap:wrap; }
.overall-score { font-size:48px; font-weight:800; line-height:1; }
.overall-lbl { font-family:'DM Mono',monospace; font-size:9px; color:#9ca3af; text-transform:uppercase; letter-spacing:1px; }

.score-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:20px; }
.score-card { background:#f8f9fa; border:1px solid #e5e7eb; border-radius:10px; padding:14px 12px; text-align:center; }
.score-grade { font-size:26px; font-weight:800; line-height:1; margin-bottom:5px; }
.score-lbl { font-family:'DM Mono',monospace; font-size:10px; color:#9ca3af; text-transform:uppercase; letter-spacing:0.5px; }

.perf-card { border:1px solid #e5e7eb; border-radius:10px; padding:1.1rem 1.25rem; background:#fff; margin-bottom:10px; }
.perf-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.perf-lbl { font-family:'DM Mono',monospace; font-size:10px; text-transform:uppercase; letter-spacing:0.5px; color:#9ca3af; margin-bottom:3px; }
.perf-val { font-size:18px; font-weight:700; color:#0077b5; }
.perf-sub { font-family:'DM Mono',monospace; font-size:11px; color:#9ca3af; margin-top:1px; }

.feedback-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px; }
.feedback-col-r { display:flex; flex-direction:column; gap:10px; }
.fb-card { border:1px solid #e5e7eb; border-radius:10px; padding:1.1rem 1.25rem; background:#fff; }
.fb-card.killers { border-color:#fecaca; background:#fef2f2; display:none; }

.pt-list { list-style:none; }
.pt-list li { display:flex; gap:10px; padding:7px 0; font-size:13.5px; line-height:1.55; color:#374151; border-bottom:1px solid #f3f4f6; }
.pt-list li:last-child { border-bottom:none; }
.pt-dot { flex-shrink:0; width:17px; height:17px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:9px; font-weight:700; margin-top:2px; }
.dot-g { background:#dcfce7; color:#16a34a; }
.dot-b { background:#fee2e2; color:#dc2626; }

.hook-box { background:#f8f9fa; border:1px solid #e5e7eb; border-radius:8px; padding:14px 16px; position:relative; }
.hook-text { font-family:'DM Mono',monospace; font-size:13px; line-height:1.7; color:#0f172a; white-space:pre-wrap; padding-right:60px; }
.copy-btn { position:absolute; top:9px; right:9px; background:white; border:1px solid #e5e7eb; color:#9ca3af; font-family:'DM Mono',monospace; font-size:10px; padding:3px 9px; border-radius:5px; cursor:pointer; }

.strat-list { list-style:none; display:flex; flex-direction:column; gap:6px; }
.strat-list li { display:flex; gap:10px; align-items:flex-start; }
.strat-bullet { color:#0077b5; font-weight:700; font-size:13px; line-height:1.5; flex-shrink:0; }

.hashtag-row { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
.hashtag-tip { font-size:11.5px; color:#9ca3af; font-family:'DM Mono',monospace; line-height:1.5; }

.media-wrap { position:relative; display:inline-block; }
.media-wrap img { max-height:180px; max-width:100%; border-radius:7px; border:1px solid #e5e7eb; object-fit:contain; }
.media-badge { position:absolute; top:6px; left:6px; font-family:'DM Mono',monospace; font-size:10px; padding:2px 7px; border-radius:20px; }
.badge-img { background:#dcfce7; color:#15803d; border:1px solid #bbf7d0; }
.badge-vid { background:#fff7ed; color:#c2410c; border:1px solid #fed7aa; }
.media-rm { position:absolute; top:5px; right:5px; background:white; border:1px solid #d1d5db; color:#6b7280; width:22px; height:22px; border-radius:50%; cursor:pointer; font-size:10px; display:flex; align-items:center; justify-content:center; }
.vid-card { background:white; border:1px solid #e5e7eb; border-radius:8px; padding:1.25rem 1.5rem; display:flex; flex-direction:column; align-items:center; gap:5px; }

#results { display:none; }
</style>
</head>
<body>
<div id="app">

  <div class="header">
    <div class="header-logo">in</div>
    <div>
      <div class="header-title">LinkedIn Post Rater</div>
      <div class="header-sub">EF Edition ‚Äî AI-powered draft analysis</div>
    </div>
    <div class="header-badge">Claude-powered</div>
  </div>

  <div class="post-box">
    <div class="lbl">Your draft post</div>
    <textarea id="post-input" class="post-textarea" placeholder="Paste your LinkedIn post draft here...&#10;&#10;Ex: I just spent 3 days watching EF founders pitch for the first time. Here's what separates the ones who go on to raise from top-tier VCs..."></textarea>
    <div class="char-count" id="char-count" style="color:#9ca3af">0 chars</div>
  </div>

  <div class="drop-zone" id="drop-zone">
    <input type="file" id="file-input" accept="image/*,video/*" style="display:none" />
    <div class="lbl" style="text-align:left; margin-bottom:8px;">Image or Video (optional)</div>
    <div id="drop-hint">
      <div style="font-size:22px; margin-bottom:6px;">üñºÔ∏è</div>
      <div style="font-family:'DM Mono',monospace; font-size:12px; color:#9ca3af;">Drop or click to attach an image / video</div>
      <div style="font-family:'DM Mono',monospace; font-size:10px; color:#9ca3af; margin-top:4px;">jpg ¬∑ png ¬∑ gif ¬∑ webp ¬∑ mp4 ¬∑ mov</div>
    </div>
    <div id="media-preview" style="display:none;"></div>
  </div>

  <div class="accordion">
    <div class="acc-header" id="acc-header">
      <span>üë§</span>
      <span>Your LinkedIn profile context</span>
      <span style="font-family:'DM Mono',monospace; font-size:10px; color:#9ca3af;">(optional ‚Äî improves accuracy)</span>
      <span class="acc-arrow" id="acc-arrow">‚ñº</span>
    </div>
    <div class="acc-body" id="acc-body">
      <div class="grid2">
        <div>
          <div class="lbl">Followers count</div>
          <input type="number" id="followers" placeholder="e.g. 2400" class="input-field" />
        </div>
        <div>
          <div class="lbl">Your role at EF</div>
          <select id="role" class="input-field">
            <option value="">Select role‚Ä¶</option>
            <option>Talent Investor (TI)</option>
            <option>General Manager (GM)</option>
            <option>Founder / EF Alumni</option>
            <option>Partner</option>
            <option>Operations / Community</option>
            <option>Other</option>
          </select>
        </div>
        <div>
          <div class="lbl">Primary audience</div>
          <select id="audience" class="input-field">
            <option value="">Select audience‚Ä¶</option>
            <option>European tech talent / aspiring founders</option>
            <option>Early-stage founders</option>
            <option>VCs &amp; investors</option>
            <option>Tech professionals</option>
            <option>Startup ecosystem broadly</option>
          </select>
        </div>
        <div>
          <div class="lbl">EF city</div>
          <select id="city" class="input-field">
            <option value="">Select city‚Ä¶</option>
            <option>Paris</option>
            <option>London</option>
            <option>Berlin</option>
            <option>Singapore</option>
            <option>New York</option>
            <option>Global / Remote</option>
          </select>
        </div>
      </div>
      <div>
        <div class="lbl">Your content niche (optional)</div>
        <input type="text" id="niche" placeholder="e.g. cofounder matching, deep tech, European founders going to the US‚Ä¶" class="input-field" />
      </div>
    </div>
  </div>

  <div class="error-box" id="error-box"></div>
  <button class="btn-analyze" id="analyze-btn" onclick="analyze()">‚ö° Analyze Post</button>

  <div id="results">
    <div class="divider"><span>Analysis Results</span><hr /></div>
    <div class="card" style="background:#f8f9fa;">
      <div class="verdict-header">
        <div>
          <div class="overall-score" id="res-score"></div>
          <div class="overall-lbl">Overall Score</div>
        </div>
        <div>
          <div class="lbl">Post type</div>
          <div style="font-weight:700; font-size:14px;" id="res-type"></div>
        </div>
        <div style="flex:1; min-width:140px;">
          <div class="lbl">Target audience</div>
          <div style="font-weight:600; font-size:13px; color:#374151;" id="res-audience"></div>
        </div>
      </div>
      <p style="font-size:13.5px; line-height:1.65; color:#374151;" id="res-verdict"></p>
    </div>

    <div class="divider"><span>Score Breakdown</span><hr /></div>
    <div class="score-grid" id="score-grid"></div>

    <div class="perf-card">
      <div style="font-family:'DM Mono',monospace; font-size:10px; text-transform:uppercase; letter-spacing:1px; color:#9ca3af; margin-bottom:12px; display:flex; align-items:center; gap:5px;"><span>üìä</span>Expected Performance</div>
      <div class="perf-grid" id="perf-grid"></div>
    </div>

    <div class="divider"><span>Feedback</span><hr /></div>
    <div class="feedback-grid">
      <div class="fb-card">
        <div class="card-title">‚úÖ What's Working</div>
        <ul class="pt-list" id="pros-list"></ul>
      </div>
      <div class="feedback-col-r">
        <div class="fb-card">
          <div class="card-title">üîß What to Change</div>
          <ul class="pt-list" id="cons-list"></ul>
        </div>
        <div class="fb-card killers" id="killers-card">
          <div class="card-title" style="color:#dc2626;">üö® Algorithm Killers</div>
          <ul class="pt-list" id="killers-list"></ul>
        </div>
      </div>
    </div>

    <div class="divider"><span>Hook Rewrite</span><hr /></div>
    <div class="card">
      <div class="card-title">‚úçÔ∏è Suggested Hook</div>
      <div class="hook-box">
        <button class="copy-btn" id="copy-btn" onclick="copyHook()">Copy</button>
        <p class="hook-text" id="hook-text"></p>
      </div>
    </div>

    <div class="divider"><span>Posting Strategy</span><hr /></div>
    <div class="card">
      <div class="card-title">üïê When &amp; How to Post</div>
      <ul class="strat-list" id="strat-list"></ul>
    </div>

    <div class="divider"><span>Hashtags</span><hr /></div>
    <div class="card">
      <div class="hashtag-row" id="hashtag-row"></div>
    </div>
  </div>

</div>
<script>
const SYSTEM_PROMPT = `You are an expert LinkedIn content strategist for the European tech startup ecosystem, specializing in content for Entrepreneurs First (EF).

## ABOUT ENTREPRENEURS FIRST (EF)
EF is the world's leading talent-first startup program. Unlike traditional accelerators, EF recruits exceptional individuals BEFORE they have a startup idea or cofounder, helps them find a cofounder, develop their thesis, and backs them at company formation with pre-seed investment. Offices: London, Paris, Berlin, Singapore, New York. 500+ companies backed. Notable alumni: Cleo, PolyAI, Tractable, Magic Pony (acq. Twitter), Luminance, ComplyAdvantage.

## EF CONTENT MISSION ON LINKEDIN
Posts are created by Talent Investors (TIs), GMs, Partners, and Founders/Alumni. Goals:
1. Attract exceptional European tech talent (PhDs, engineers, researchers, domain experts) to apply to EF
2. Position EF as THE place for ambitious technical talent to become founders
3. Build credibility in the VC/founder ecosystem
4. Share genuine insights on talent investing, cofounder dynamics, company formation, zero-to-one

## EF AUDIENCE
- Primary: European tech talent (25-35yo) considering the leap to founding
- Secondary: Startup ecosystem (VCs, angels, other accelerators, founders)
- Tertiary: Portfolio founders and EF alumni network
- What they care about: cofounder matching, first funding, 0-to-1, European vs US startup scene, talent investing thesis, success stories

## EF CONTENT PILLARS THAT PERFORM WELL
- Founder success stories with emotional arc + EF origin story (not just "$X raised")
- Behind-the-scenes of cofounder matching and early company formation
- "Talent investing" as a concept ‚Äî finding founders before they're founders
- Data on what makes EF founders succeed vs fail
- European tech talent moving to the US ‚Äî hot topic
- Hot takes on VC models, accelerator models, talent vs idea-first investing
- Personal journeys: engineer/researcher/domain expert to founder

## EF CONTENT TONE
- Sharp and direct, no corporate speak
- Authentic over polished ‚Äî real people, real journeys
- Celebratory for portfolio wins but with substance
- Intellectual curiosity ‚Äî EF audience is high-caliber, they want depth
- Avoid: generic startup platitudes, overly salesy recruitment posts, buzzword soup

---

## LINKEDIN ALGORITHM 2025/2026 DATA
Source: Richard van der Blom Algorithm Insights Report (1.8M posts analyzed) + Hootsuite/Sprout Social/Buffer research

### Macro context
- Organic reach DOWN ~50% YoY, engagement DOWN ~25%, follower growth DOWN ~59%
- LinkedIn 2025/26 rewards expertise, niche authority, dwell time, and conversation quality
- Algorithm weights QUALITY of interactions and time spent reading ‚Äî not just raw engagement volume

### Format performance hierarchy (data-backed)
1. Document/carousel (PDF) ‚Äî 6.6% engagement rate, highest of any format. 40x more saves. Best for frameworks, data, step-by-step content
2. Native video ‚Äî +69% performance boost. Vertical, under 60 seconds, face/logo in first 4 seconds
3. Text + image ‚Äî Most stable (58% of all content). Optimal: 700-900 chars. Real person photo = up to 50% more engagement. Selfie > team photo > branded graphic > stock > AI
4. Text-only ‚Äî 800-1,000 chars sweet spot. Needs strong hook + white space. Highest comment volume potential
5. Link posts ‚Äî 2025 update: modest 5% gain (algorithm softened). Link at END of caption only
6. External links in post body ‚Äî Still penalized. Add via EDIT after 60 min OR have colleague drop in comments

### Dwell time ‚Äî key 2025 ranking signal
- LinkedIn now measures time spent reading (not just whether someone engages)
- Well-formatted posts perform 2.1x better in reach
- 72% of LinkedIn traffic is mobile ‚Äî short paragraphs, line breaks, zero walls of text

### Hook mechanics (first 150 characters = everything)
- Only 2 lines visible before "see more" on mobile ‚Äî hook decides whether anyone reads
- Algorithm uses early click-through on "see more" as quality signal
- Hook archetypes that convert:
  * Pattern interrupt: "I got fired. Best thing that happened." / "Everyone said don't post this."
  * Tension/open loop: "My startup failed. Here's what I learned." / "I almost quit last month."
  * Specific stat/claim: "This one change doubled our applicant quality."
  * Direct address: "If you're thinking about founding ‚Äî read this first."
  * Counterintuitive: "Stop posting on LinkedIn." / "The best EF founders almost didn't apply."
- Bad hooks: "Recap of last week", "Excited to share", "Big news!", vague setups with no tension

### What actually moves the needle
- Comments = ~2x the algo signal of a like
- Comment quality matters ‚Äî algorithm detects substantive replies vs emoji drops
- Comments after 90 min = 1.8x more impact than early comments
- Saves + reposts = strongest reach drivers after comments
- First 60-90 minutes are critical ‚Äî post when you can engage immediately
- Engage with 5-10 other posts right after publishing ‚Äî signals activity, boosts distribution
- Reply to ALL comments fast ‚Äî keeps thread alive
- Never self-comment ‚Äî detected as self-promo, reach penalty

### Tagging strategy
- Tag founders/companies only if likely to engage ‚Äî 1 tagged person engaging = strong signal
- Tag naturally in the body, NOT as a CC list at the end
- Max 3-5 meaningful tags. Tagging 30 people = farming signal, suppressed
- Colleagues who engage quickly = free algo boost

### Hashtags 2025 update
- LinkedIn now uses improved text detection ‚Äî hashtags matter LESS for discoverability
- Max 3 hashtags ‚Äî more = spam signal
- Niche-specific over generic (#founder > #startups)
- No longer a primary distribution lever

### Posting timing & cadence
- Best days: Tuesday > Wednesday > Thursday (Tuesday +20% engagement vs Friday)
- Best times: 8-9 AM, 10-11 AM (morning), 12-1 PM (lunch), 2-5 PM (afternoon)
- Worst: weekends (45% less engagement), after 6 PM, before 7 AM
- Consistency beats frequency: 3-4x/week = +78% engagement vs irregular posting
- Posts have 2-3 week lifespan now if they spark sustained conversation

### Algorithm killers
- Engagement bait ("Comment YES if you agree") ‚Äî detected and suppressed
- External links in post body ‚Äî always penalized
- Salesy/promotional content without value ‚Äî buried aggressively in 2025/26
- Generic content with no niche signal
- Sharing post URL on Slack/Teams ‚Äî algo detects coordinated traffic = farming
- Repetitive posts on same topic from same creator
- Self-commenting
- Mass tagging without engagement context

### Internal sharing
- NEVER share post URL on Slack ‚Äî detected as coordinated engagement farming
- Tell team "I just posted" ‚Äî they find it organically in feed

### Benchmarks 2025
- Avg engagement rate: ~3.85%
- Carousel/document: 6.6% engagement rate
- Plain text: ~2% engagement rate
- Video: +69% impressions, lower engagement rate than carousels
- Median: ~45 likes, ~4 comments, ~3 shares per post
- Posts >1,500 chars see higher reach
- 1,000+ impressions in hour 1 = strong predictor of total reach

---

Respond ONLY with valid JSON, no markdown, no extra text:

{
  "overall_score": "A/B/C/D/F",
  "post_type": "Personal Story / Thought Leadership / Data-Driven / Portfolio Win / Recruitment / How-To / Hot Take / News",
  "target_audience": "short description of who this will resonate with most",
  "verdict": "2-3 sentences of sharp, honest overall assessment ‚Äî be specific, not generic",
  "scores": {
    "hook": {"grade": "A/B/C/D/F", "label": "Hook Strength"},
    "value": {"grade": "A/B/C/D/F", "label": "Value Delivered"},
    "readability": {"grade": "A/B/C/D/F", "label": "Readability"},
    "cta": {"grade": "A/B/C/D/F", "label": "CTA / Engagement"}
  },
  "expected_impressions": "calibrated range based on follower count and format",
  "expected_engagement_rate": "% vs 3.85% avg benchmark",
  "expected_comments": "estimated range",
  "expected_shares": "estimated range",
  "pros": ["what is working ‚Äî specific, reference EF context and algo data. Min 2, max 4 items."],
  "cons": ["what to improve ‚Äî specific and actionable. Min 2, max 4 items."],
  "red_flags": ["algo-killing mistakes only ‚Äî empty array [] if none. Name the specific killer and its impact."],
  "hashtags": ["3 max, niche-specific"],
  "hashtag_tip": "one sharp strategic note on hashtag usage for this post",
  "posting_strategy": "Specific day + time window. Who to tag and why. First-hour playbook. Whether to add link in comments. Teammate activation.",
  "hook_rewrite": "Rewrite ONLY the first 2-3 lines. Keep the author voice. Use a proven hook archetype. Short sentences. White space. Tension or curiosity before see more.",
  "visual": {
    "grade": "A/B/C/D/F or null if no media",
    "media_type": "image / video / none",
    "visual_type": "selfie / team photo / event photo / branded graphic / stock photo / AI-generated / screenshot / other",
    "reach_impact": "one-liner on reach impact of this media choice vs alternatives",
    "points": ["2-3 specific observations on quality, authenticity, faces, framing, EF branding"],
    "suggestion": "one sharp recommendation to improve visual or add one"
  }
}`;

const GRADE_COLOR = { A:'#16a34a', B:'#2563eb', C:'#ca8a04', D:'#ea580c', F:'#dc2626' };

let mediaData = null;
let accOpen = false;

// Char counter
document.getElementById('post-input').addEventListener('input', function() {
  const n = this.value.length;
  const el = document.getElementById('char-count');
  el.textContent = n + ' chars' + (n > 800 && n < 2100 ? ' ¬∑ good length' : n > 2100 ? ' ¬∑ getting long' : '');
  el.style.color = n > 2800 ? '#ea580c' : n > 800 ? '#16a34a' : '#9ca3af';
});

// Accordion
document.getElementById('acc-header').addEventListener('click', function() {
  accOpen = !accOpen;
  document.getElementById('acc-body').classList.toggle('open', accOpen);
  document.getElementById('acc-arrow').classList.toggle('open', accOpen);
});

// File handling
function handleFile(file) {
  if (!file) return;
  const isImage = file.type.startsWith('image/');
  const isVideo = file.type.startsWith('video/');
  if (!isImage && !isVideo) return;
  const reader = new FileReader();
  reader.onload = e => {
    const dataUrl = e.target.result;
    mediaData = { type: isImage ? 'image' : 'video', base64: isImage ? dataUrl.split(',')[1] : null, mimeType: file.type, fileName: file.name, previewUrl: isImage ? dataUrl : null };
    renderMedia();
  };
  reader.readAsDataURL(file);
}

function renderMedia() {
  const hint = document.getElementById('drop-hint');
  const preview = document.getElementById('media-preview');
  const zone = document.getElementById('drop-zone');
  if (!mediaData) {
    hint.style.display = 'block'; preview.style.display = 'none'; preview.innerHTML = ''; zone.style.cursor = 'pointer';
    return;
  }
  hint.style.display = 'none'; preview.style.display = 'block'; zone.style.cursor = 'default';
  if (mediaData.type === 'image') {
    preview.innerHTML = `<div class="media-wrap"><img src="${mediaData.previewUrl}" alt=""/><span class="media-badge badge-img">üñº Image</span><button class="media-rm" onclick="removeMedia(event)">‚úï</button></div>`;
  } else {
    preview.innerHTML = `<div class="media-wrap"><div class="vid-card"><span style="font-size:28px">üé¨</span><div style="font-family:'DM Mono',monospace;font-size:12px;color:#0f172a;max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${mediaData.fileName}</div><div style="font-family:'DM Mono',monospace;font-size:11px;color:#9ca3af">Video detected ‚Äî reach advice will be adapted</div></div><span class="media-badge badge-vid">üìπ Video</span><button class="media-rm" onclick="removeMedia(event)">‚úï</button></div>`;
  }
}

function removeMedia(e) {
  e.stopPropagation();
  mediaData = null;
  document.getElementById('file-input').value = '';
  renderMedia();
}

const dropZone = document.getElementById('drop-zone');
dropZone.addEventListener('click', () => { if (!mediaData) document.getElementById('file-input').click(); });
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => { e.preventDefault(); dropZone.classList.remove('drag-over'); handleFile(e.dataTransfer.files[0]); });
document.getElementById('file-input').addEventListener('change', e => handleFile(e.target.files[0]));

async function analyze() {
  const post = document.getElementById('post-input').value.trim();
  if (!post) { showError('Please enter your LinkedIn post draft.'); return; }

  const followers = document.getElementById('followers').value;
  const role = document.getElementById('role').value;
  const audience = document.getElementById('audience').value;
  const city = document.getElementById('city').value;
  const niche = document.getElementById('niche').value;

  const profileCtx = [
    followers && `Followers: ${followers}`,
    role && `Role at EF: ${role}`,
    audience && `Primary audience: ${audience}`,
    city && `EF city: ${city}`,
    niche && `Content niche: ${niche}`,
  ].filter(Boolean).join('\n');

  const textContent = `Analyze this LinkedIn post draft:\n\n---\n${post}\n---\n${profileCtx ? '\nAuthor profile context:\n' + profileCtx : ''}\n${mediaData ? '\nMedia attached: ' + mediaData.type + ' (' + mediaData.fileName + ')' : '\nNo image or video attached.'}\n\nIMPORTANT: Always include the "visual" object in JSON. Calibrate impression/engagement estimates to author's follower count if provided. Return JSON only.`;

  const msgContent = (mediaData?.type === 'image' && mediaData?.base64)
    ? [{ type:'image', source:{ type:'base64', media_type:mediaData.mimeType, data:mediaData.base64 } }, { type:'text', text:textContent }]
    : textContent;

  hideError();
  setLoading(true);
  document.getElementById('results').style.display = 'none';

  try {
    const resp = await fetch('/api/analyze', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-haiku-4-5-20251001',
        max_tokens: 4000,
        system: SYSTEM_PROMPT,
        messages: [{ role:'user', content:msgContent }]
      })
    });
    if (!resp.ok) throw new Error(`API error ${resp.status}`);
    const data = await resp.json();
    const raw = data.content.map(b => b.text || '').join('');
    renderResults(JSON.parse(raw.replace(/```json|```/g,'').trim()));
  } catch(e) {
    showError('Analysis failed: ' + e.message);
  } finally {
    setLoading(false);
  }
}

function renderResults(r) {
  const sc = document.getElementById('res-score');
  sc.textContent = r.overall_score;
  sc.style.color = GRADE_COLOR[r.overall_score] || '#0f172a';
  document.getElementById('res-type').textContent = r.post_type;
  document.getElementById('res-audience').textContent = r.target_audience;
  document.getElementById('res-verdict').textContent = r.verdict;

  document.getElementById('score-grid').innerHTML = Object.values(r.scores || {}).map(s =>
    `<div class="score-card"><div class="score-grade" style="color:${GRADE_COLOR[s.grade]||'#9ca3af'}">${s.grade}</div><div class="score-lbl">${s.label}</div></div>`
  ).join('');

  document.getElementById('perf-grid').innerHTML = [
    { label:'Impressions', val:r.expected_impressions, sub:'organic reach' },
    { label:'Engagement Rate', val:r.expected_engagement_rate, sub:'avg: 3.85%' },
    { label:'Comments', val:r.expected_comments, sub:'est. replies' },
    { label:'Shares', val:r.expected_shares, sub:'amplification' },
  ].map(m => `<div><div class="perf-lbl">${m.label}</div><div class="perf-val">${m.val}</div><div class="perf-sub">${m.sub}</div></div>`).join('');

  const prosItems = [...(r.pros||[]), ...(r.visual?.media_type !== 'none' && r.visual?.reach_impact ? ['Visual: '+r.visual.reach_impact] : [])];
  document.getElementById('pros-list').innerHTML = prosItems.map(i => `<li><span class="pt-dot dot-g">‚úì</span><span>${i}</span></li>`).join('');

  const consItems = [...(r.cons||[]), ...(r.visual?.media_type === 'none' && r.visual?.suggestion ? ['Visual: '+r.visual.suggestion] : [])];
  document.getElementById('cons-list').innerHTML = consItems.map(i => `<li><span class="pt-dot dot-b">‚úó</span><span>${i}</span></li>`).join('');

  const kc = document.getElementById('killers-card');
  if (r.red_flags?.length > 0) {
    kc.style.display = 'block';
    document.getElementById('killers-list').innerHTML = r.red_flags.map(i => `<li style="color:#dc2626"><span class="pt-dot dot-b">!</span><span>${i}</span></li>`).join('');
  } else { kc.style.display = 'none'; }

  document.getElementById('hook-text').textContent = r.hook_rewrite;

  document.getElementById('strat-list').innerHTML = (r.posting_strategy||'')
    .split(/(?<=[.!])\s+/).filter(s => s.trim().length > 4)
    .map(s => `<li><span class="strat-bullet">‚Äî</span><span style="font-size:13px;color:#374151;line-height:1.55">${s.trim()}</span></li>`).join('');

  document.getElementById('hashtag-row').innerHTML =
    `<div>${(r.hashtags||[]).map(h=>`<span class="tag tag-blue">#${h.replace('#','')}</span>`).join('')}</div><span class="hashtag-tip">${r.hashtag_tip||''}</span>`;

  const res = document.getElementById('results');
  res.style.display = 'block';
  res.classList.add('fade-up');
  res.scrollIntoView({ behavior:'smooth', block:'start' });
}

function copyHook() {
  navigator.clipboard.writeText(document.getElementById('hook-text').textContent).then(() => {
    const btn = document.getElementById('copy-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
  });
}

function setLoading(on) {
  const btn = document.getElementById('analyze-btn');
  btn.disabled = on;
  btn.innerHTML = on ? '<span class="spinner"></span>Analyzing‚Ä¶' : '‚ö° Analyze Post';
}
function showError(msg) { const e = document.getElementById('error-box'); e.textContent = msg; e.style.display = 'block'; }
function hideError() { document.getElementById('error-box').style.display = 'none'; }
</script>
</body>
</html>
