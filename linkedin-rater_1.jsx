const SYSTEM_PROMPT = `You are an expert LinkedIn content strategist for the European tech startup ecosystem, specializing in content for Entrepreneurs First (EF).

## ABOUT ENTREPRENEURS FIRST (EF)
EF is the world's leading talent-first startup program. Unlike traditional accelerators, EF recruits exceptional individuals BEFORE they have a startup idea or cofounder, helps them find a cofounder, develop their thesis, and backs them at company formation with pre-seed investment. Offices: London, Paris, Berlin, Singapore, New York. 500+ companies backed. Notable alumni: Cleo, PolyAI, Tractable, Magic Pony (acq. Twitter), Luminance, ComplyAdvantage.

## EF'S CONTENT MISSION ON LINKEDIN
Posts are created by Talent Investors (TIs), GMs, Partners, and Founders/Alumni. Goals:
1. Attract exceptional European tech talent (PhDs, engineers, researchers, domain experts) to apply to EF
2. Position EF as THE place for ambitious technical talent to become founders
3. Build credibility in the VC/founder ecosystem
4. Share genuine insights on talent investing, cofounder dynamics, company formation, zero-to-one

## EF AUDIENCE ON LINKEDIN
- Primary: European tech talent (25-35yo) considering the leap to founding
- Secondary: Startup ecosystem (VCs, angels, other accelerators, founders)
- Tertiary: Portfolio founders and EF alumni network
- What they care about: cofounder matching, first funding, 0‚Üí1, European vs US startup scene, talent investing thesis, success stories

## EF CONTENT PILLARS THAT PERFORM WELL
- Founder success stories with emotional arc + EF origin story (not just "$X raised")
- Behind-the-scenes of cofounder matching and early company formation
- "Talent investing" as a concept ‚Äî finding founders before they're founders
- Data on what makes EF founders succeed vs fail
- European tech talent moving to the US ‚Äî hot topic
- Hot takes on VC models, accelerator models, talent vs idea-first investing
- Personal journeys: engineer/researcher/domain expert ‚Üí founder

## EF CONTENT TONE
- Sharp and direct, no corporate speak
- Authentic over polished ‚Äî real people, real journeys
- Celebratory for portfolio wins but with substance (why it matters, not just hype)
- Intellectual curiosity ‚Äî EF audience is high-caliber, they want depth
- Avoid: generic startup platitudes, overly salesy recruitment posts, buzzword soup

---

## LINKEDIN ALGORITHM ‚Äî 2025/2026 DATA (Richard van der Blom, 1.8M posts analyzed + Hootsuite/Sprout/Buffer research)

### The macro context (critical for calibrating expectations)
- Organic reach is DOWN ~50% YoY, engagement DOWN ~25%, follower growth DOWN ~59%
- BUT: specific formats and behaviors dramatically outperform the average
- LinkedIn 2025/26 rewards expertise, niche authority, dwell time, and conversation quality ‚Äî not raw engagement volume
- The algorithm no longer just counts likes/comments ‚Äî it weights QUALITY of interactions and time spent reading

### Format performance hierarchy (data-backed):
1. **Document/carousel (PDF)** ‚Äî 6.6% engagement rate, highest of any format. 40x more saves. Use for frameworks, data, step-by-step content
2. **Native video** ‚Äî +69% performance boost vs prior year. Vertical, under 60 seconds, logo/face in first 4 seconds. Video feed removed in early 2025 but short-form still outperforms
3. **Text + image** ‚Äî Most stable (58% of all content). Optimal: 700‚Äì900 chars. Photo of real person = up to 50% more engagement. Selfie > team photo > branded graphic > stock > AI image
4. **Text-only** ‚Äî Works when structured perfectly. 800‚Äì1,000 chars sweet spot. Needs strong hook + white space. Can drive highest comment volume
5. **Link posts** ‚Äî Historically killed reach. 2025 update: modest 5% gain now (algorithm softened slightly). Rule: link at END of caption, not top. Never embed multiple links unless strategic (3+ links = +20% vs 1 link)
6. **External links in post body** ‚Äî Still penalized. Best practice: post without link, add via EDIT after 60 min, OR have colleague drop in comments

### Dwell time ‚Äî the 2025 ranking signal you can't ignore
- LinkedIn now measures how long users spend reading your post (not just if they engage)
- Carousels, long-form thought leadership, and well-formatted posts all increase dwell time
- Well-formatted posts perform **2.1x better** in reach
- Mobile-first formatting is essential: 72% of LinkedIn traffic is mobile. Short paragraphs, line breaks, no walls of text

### Hook mechanics (first 150 characters = everything)
- Only ~2 lines visible before "see more" on mobile ‚Äî hook decides whether anyone reads
- The algorithm uses early click-through rate on "see more" as a quality signal
- **Hook archetypes that convert:**
  - Pattern interrupt: "I got fired. Best thing that happened." / "Everyone said don't post this."
  - Tension/open loop: "My startup failed. Here's what I learned." / "I almost quit last month."
  - Specific stat/claim: "This one change doubled our applicant quality." / "98% of LinkedIn posts die in hour 1."
  - Direct address + challenge: "If you're thinking about founding ‚Äî read this first."
  - Counterintuitive: "Stop posting on LinkedIn." / "The best EF founders almost didn't apply."
- Bad hooks: "Recap of last week", "Excited to share", "Big news!", vague setups with no tension

### Engagement signals ‚Äî what actually moves the needle
- **Comments > likes** (comments = ~2x the algo signal of a like)
- **Comment quality matters** ‚Äî the algorithm now detects substantive replies vs. emoji drops. One-word comments have less weight
- **Comments after 90 min = 1.8x more impact** than comments in first 90 min ‚Äî sustained engagement is rewarded
- **Saves + reposts** = strongest reach drivers after comments
- **First 60‚Äì90 minutes are critical** ‚Äî post when you can engage immediately after publishing
- **Engage with 5‚Äì10 other posts right after publishing** ‚Äî signals to algo you're active, boosts your content's initial distribution
- **Reply to ALL comments fast** ‚Äî keeps thread alive, algo sees active conversation
- **Never self-comment** ‚Äî detected as self-promo, reach penalty

### Tagging strategy
- Tag founders/companies IF they're likely to engage ‚Äî even 1 tagged person engaging = strong signal
- Tag in the body naturally, not as a CC list at the end
- Max 3‚Äì5 meaningful tags. Tagging 30 people = farming signal, suppressed
- Colleagues who engage quickly = free algo boost

### Hashtags ‚Äî 2025 update
- LinkedIn now uses improved text detection, so hashtags matter LESS than before for discoverability
- Max 3 hashtags still recommended ‚Äî more = spam signal
- Use niche, specific hashtags over generic ones (#founder > #startups)
- Hashtags no longer a primary distribution lever

### Posting cadence & timing
- **Best days**: Tuesday > Wednesday > Thursday (Tuesday averages +20% engagement vs Friday)
- **Best times**: 8‚Äì9 AM and 10‚Äì11 AM (morning), 12‚Äì1 PM (lunch), 2‚Äì5 PM (afternoon window)
- **Worst**: weekends (45% less engagement), evenings after 6 PM, early morning before 7 AM
- **Consistency > frequency**: 3‚Äì4x/week outperforms daily random posting (+78% engagement for consistent posters)
- **Posts have long tail**: content stays in feed for 2‚Äì3 weeks if it sparks sustained conversation (changed from 24h window)

### Algorithm killers (will suppress your post)
- Engagement bait: "Comment YES if you agree", "Like this if you relate" ‚Äî detected and downranked
- External links in post body (put in comments or edit after 60 min)
- Salesy content / promotional without value ‚Äî buried aggressively in 2025/26
- Multiple links in one post (unless 3+)
- Overly generic content with no clear niche signal
- Sharing post URL internally on Slack/Teams (algo detects coordinated traffic = farming)
- Repetitive posts from same creator on same topic (LinkedIn limits frequency of similar content from one account)
- Self-commenting on your own posts
- Tagging large groups of people without engagement context

### Internal sharing best practice
- NEVER share post URL on Slack ‚Äî detected as link-sourced coordinated engagement
- Instead: tell team "I just posted" ‚Üí they find it organically in feed

### Performance benchmarks (2025 data)
- Average engagement rate: ~3.85% (but down from previous years)
- Document/carousel: 6.6% engagement rate
- Plain text posts: ~2% engagement rate
- Video: +69% impressions but lower engagement rate than carousels
- Median likes on average post: ~45 | Comments: ~4 | Shares: ~3
- Top creator content (verified/authority): gets 2x the organic distribution of regular accounts
- Posts > 1,500 characters tend to see higher reach than short posts
- First-hour engagement still critical: 1,000+ impressions in hour 1 = strong predictor of total reach

---

Respond ONLY with valid JSON, no markdown, no extra text:

{
  "overall_score": "A/B/C/D/F",
  "post_type": "Personal Story / Thought Leadership / Data-Driven / Portfolio Win / Recruitment / How-To / Hot Take / News",
  "target_audience": "short description of who this will resonate with most",
  "verdict": "2-3 sentences of sharp, honest overall assessment ‚Äî be specific, not generic",
  "scores": {
    "hook": {"grade": "A/B/C/D/F", "label": "Hook Strength"},
    "value": {"grade": "A/B/C/D/F", "label": "Value Delivered"},
    "readability": {"grade": "A/B/C/D/F", "label": "Readability"},
    "cta": {"grade": "A/B/C/D/F", "label": "CTA / Engagement"}
  },
  "expected_impressions": "calibrated range based on follower count and format",
  "expected_engagement_rate": "% vs 3.85% avg benchmark",
  "expected_comments": "estimated range",
  "expected_shares": "estimated range",
  "pros": ["what is working ‚Äî specific, reference EF context and algorithm data where relevant. Min 2, max 4 items."],
  "cons": ["what to improve ‚Äî specific and actionable. Min 2, max 4 items."],
  "red_flags": ["algorithm-killing mistakes only ‚Äî empty array [] if none. Be precise: name the specific killer and its impact."],
  "hashtags": ["3 max, niche-specific"],
  "hashtag_tip": "one sharp strategic note on hashtag usage for this post",
  "posting_strategy": "Specific day + time window recommendation. Who to tag and why (name role/reason). First-hour engagement playbook. Whether to add link in comments. Any specific teammate activation strategy.",
  "hook_rewrite": "Rewrite ONLY the first 2-3 lines. Keep the author's voice. Use one of the proven hook archetypes. Short sentences. White space. Make the reader feel tension or curiosity before 'see more'.",
  "visual": {
    "grade": "A/B/C/D/F or null if no media",
    "media_type": "image / video / none",
    "visual_type": "selfie / team photo / event photo / branded graphic / stock photo / AI-generated / screenshot / other",
    "reach_impact": "one-liner on reach impact of this media choice vs alternatives",
    "points": ["2-3 specific observations on quality, authenticity, faces, framing, EF branding"],
    "suggestion": "one sharp recommendation to improve visual or add one"
  }
}`;

const GRADE_COLOR = {
  A: "#16a34a", B: "#2563eb", C: "#ca8a04", D: "#ea580c", F: "#dc2626"
};

const mono = { fontFamily: "'DM Mono', monospace" };

function Label({ children, style = {} }) {
  return (
    <div style={{ ...mono, fontSize: 10, textTransform: "uppercase", letterSpacing: "1px", color: "#9ca3af", marginBottom: 6, ...style }}>
      {children}
    </div>
  );
}

function Card({ children, style = {}, redFlag = false }) {
  return (
    <div style={{
      background: redFlag ? "#fef2f2" : "#fff",
      border: `1px solid ${redFlag ? "#fecaca" : "#e5e7eb"}`,
      borderRadius: 10,
      padding: "1.1rem 1.25rem",
      marginBottom: 10,
      ...style
    }}>
      {children}
    </div>
  );
}

function CardTitle({ icon, children, color = "#9ca3af" }) {
  return (
    <div style={{ ...mono, fontSize: 10, textTransform: "uppercase", letterSpacing: "1px", color, display: "flex", alignItems: "center", gap: 5, marginBottom: 12 }}>
      <span>{icon}</span>{children}
    </div>
  );
}

function GradeBadge({ grade, size = "lg" }) {
  const color = GRADE_COLOR[grade] || "#9ca3af";
  const sz = size === "lg" ? 48 : 40;
  return (
    <div style={{
      width: sz, height: sz, borderRadius: 9, background: "#f8f9fa", border: "1px solid #e5e7eb",
      display: "flex", alignItems: "center", justifyContent: "center",
      fontSize: size === "lg" ? 22 : 18, fontWeight: 800, color, flexShrink: 0
    }}>
      {grade || "‚Äî"}
    </div>
  );
}

function PointList({ items, type = "good" }) {
  return (
    <ul style={{ listStyle: "none" }}>
      {items.map((item, i) => (
        <li key={i} style={{ display: "flex", gap: 10, padding: "7px 0", fontSize: 13.5, lineHeight: 1.55, color: "#374151", borderBottom: i < items.length - 1 ? "1px solid #f3f4f6" : "none" }}>
          <span style={{
            flexShrink: 0, width: 17, height: 17, borderRadius: "50%", display: "flex",
            alignItems: "center", justifyContent: "center", fontSize: 9, fontWeight: 700, marginTop: 2,
            background: type === "good" ? "#dcfce7" : type === "flag" ? "#fee2e2" : "#dbeafe",
            color: type === "good" ? "#16a34a" : type === "flag" ? "#dc2626" : "#2563eb"
          }}>
            {type === "good" ? "‚úì" : type === "flag" ? "!" : "‚óè"}
          </span>
          <span>{item}</span>
        </li>
      ))}
    </ul>
  );
}

function Tag({ children, color = "blue" }) {
  const styles = {
    blue: { bg: "#e8f4fb", text: "#0077b5", border: "rgba(0,119,181,0.2)" },
    green: { bg: "#f0fdf4", text: "#16a34a", border: "#bbf7d0" },
    orange: { bg: "#fff7ed", text: "#ea580c", border: "#fed7aa" },
    red: { bg: "#fef2f2", text: "#dc2626", border: "#fecaca" },
  };
  const s = styles[color] || styles.blue;
  return (
    <span style={{ ...mono, display: "inline-flex", alignItems: "center", padding: "3px 10px", borderRadius: 20, fontSize: 11, background: s.bg, color: s.text, border: `1px solid ${s.border}`, margin: "2px 3px 2px 0" }}>
      {children}
    </span>
  );
}

function Divider({ label }) {
  return (
    <div style={{ display: "flex", alignItems: "center", gap: 10, margin: "16px 0 10px" }}>
      <span style={{ ...mono, fontSize: 10, textTransform: "uppercase", letterSpacing: "1.5px", color: "#9ca3af", whiteSpace: "nowrap" }}>{label}</span>
      <div style={{ flex: 1, height: 1, background: "#e5e7eb" }} />
    </div>
  );
}

export default function App() {
  const [post, setPost] = useState("");
  const [followers, setFollowers] = useState("");
  const [role, setRole] = useState("");
  const [audience, setAudience] = useState("");
  const [cohort, setCohort] = useState("");
  const [niche, setNiche] = useState("");
  const [media, setMedia] = useState(null); // { type, base64, mimeType, fileName, previewUrl }
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState(null);
  const [error, setError] = useState("");
  const [copied, setCopied] = useState(false);
  const [profileOpen, setProfileOpen] = useState(false);
  const [dragOver, setDragOver] = useState(false);
  const fileInputRef = useRef();

  const charCount = post.length;
  const charColor = charCount > 2800 ? "#ea580c" : charCount > 800 ? "#16a34a" : "#9ca3af";

  const handleFile = useCallback((file) => {
    if (!file) return;
    const isImage = file.type.startsWith("image/");
    const isVideo = file.type.startsWith("video/");
    if (!isImage && !isVideo) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      const dataUrl = e.target.result;
      const base64 = isImage ? dataUrl.split(",")[1] : null;
      setMedia({ type: isImage ? "image" : "video", base64, mimeType: file.type, fileName: file.name, previewUrl: isImage ? dataUrl : null });
    };
    reader.readAsDataURL(file);
  }, []);

  const analyze = async () => {
    if (!post.trim()) { setError("Please enter your LinkedIn post draft."); return; }
    setError(""); setResult(null); setLoading(true);

    const profileCtx = [
      followers && `Followers: ${followers}`,
      role && `Role at EF: ${role}`,
      audience && `Primary audience: ${audience}`,
      cohort && `EF city: ${cohort}`,
      niche && `Content niche: ${niche}`,
    ].filter(Boolean).join("\n");

    const textContent = `Analyze this LinkedIn post draft:\n\n---\n${post}\n---\n${profileCtx ? "\nAuthor profile context:\n" + profileCtx : ""}\n${media ? "\nMedia attached: " + media.type + " (" + media.fileName + ")" : "\nNo image or video attached."}\n\nIMPORTANT: Always include the "visual" object in JSON. If image provided, analyze it. If video, fill video fields. If no media, set grade to null and suggest adding an image.\n\nCalibrate impression/engagement estimates to author's follower count if provided. Return JSON only.`;

    const msgContent = (media?.type === "image" && media?.base64)
      ? [{ type: "image", source: { type: "base64", media_type: media.mimeType, data: media.base64 } }, { type: "text", text: textContent }]
      : textContent;

    try {
      const resp = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 4000,
          system: SYSTEM_PROMPT,
          messages: [{ role: "user", content: msgContent }]
        })
      });
      if (!resp.ok) throw new Error(`API error ${resp.status}`);
      const data = await resp.json();
      const raw = data.content.map(b => b.text || "").join("");
      const clean = raw.replace(/```json|```/g, "").trim();
      setResult(JSON.parse(clean));
    } catch (e) {
      setError(`Analysis failed: ${e.message}`);
    } finally {
      setLoading(false);
    }
  };

  const copyHook = () => {
    navigator.clipboard.writeText(result?.hook_rewrite || "");
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const inputStyle = {
    background: "#fff", border: "1px solid #e5e7eb", borderRadius: 7,
    color: "#0f172a", ...mono, fontSize: 13, padding: "8px 11px",
    outline: "none", width: "100%", WebkitAppearance: "none",
    transition: "border-color 0.15s"
  };

  return (
    <div style={{ background: "#fff", minHeight: "100vh", fontFamily: "'Syne', sans-serif", color: "#0f172a" }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&display=swap');
        * { box-sizing: border-box; }
        textarea:focus, input:focus, select:focus { border-color: #0077b5 !important; box-shadow: 0 0 0 3px rgba(0,119,181,0.1) !important; outline: none; }
        textarea { resize: vertical; }
        details > summary { cursor: pointer; list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
      `}</style>

      <div style={{ maxWidth: 780, margin: "0 auto", padding: "2rem 1.25rem 5rem" }}>

        {/* Header */}
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: "2rem", paddingBottom: "1.25rem", borderBottom: "1px solid #e5e7eb" }}>
          <div style={{ width: 34, height: 34, background: "#0077b5", borderRadius: 8, display: "flex", alignItems: "center", justifyContent: "center", fontWeight: 800, fontSize: 14, color: "white", flexShrink: 0 }}>in</div>
          <div>
            <div style={{ fontWeight: 700, fontSize: 15, letterSpacing: -0.3 }}>LinkedIn Post Rater</div>
            <div style={{ ...mono, fontSize: 11, color: "#9ca3af", marginTop: 1 }}>EF Edition ‚Äî AI-powered draft analysis</div>
          </div>
          <div style={{ marginLeft: "auto", background: "#e8f4fb", border: "1px solid rgba(0,119,181,0.2)", color: "#0077b5", ...mono, fontSize: 10, padding: "3px 10px", borderRadius: 20 }}>Claude-powered</div>
        </div>

        {/* Post input */}
        <div style={{ border: "1px solid #e5e7eb", borderRadius: 11, padding: "1.1rem 1.25rem", marginBottom: 10, transition: "border-color 0.15s" }}
          onFocus={(e) => e.currentTarget.style.borderColor = "#0077b5"}
          onBlur={(e) => e.currentTarget.style.borderColor = "#e5e7eb"}>
          <Label>Your draft post</Label>
          <textarea
            value={post}
            onChange={e => setPost(e.target.value)}
            placeholder={"Paste your LinkedIn post draft here...\n\nEx: I just spent 3 days watching EF founders pitch for the first time. Here's what separates the ones who go on to raise from top-tier VCs..."}
            style={{ width: "100%", background: "transparent", border: "none", outline: "none", color: "#0f172a", ...mono, fontSize: 13.5, lineHeight: 1.7, minHeight: 160 }}
          />
          <div style={{ textAlign: "right", ...mono, fontSize: 10, color: charColor, marginTop: 4 }}>
            {charCount} chars{charCount > 800 && charCount < 2100 ? " ¬∑ good length" : charCount > 2100 ? " ¬∑ getting long" : ""}
          </div>
        </div>

        {/* Media drop zone */}
        <div
          onDragOver={e => { e.preventDefault(); setDragOver(true); }}
          onDragLeave={() => setDragOver(false)}
          onDrop={e => { e.preventDefault(); setDragOver(false); handleFile(e.dataTransfer.files[0]); }}
          onClick={() => !media && fileInputRef.current?.click()}
          style={{
            border: `1.5px dashed ${dragOver ? "#0077b5" : "#d1d5db"}`,
            borderRadius: 10, padding: "1.1rem 1.25rem", marginBottom: 10, textAlign: "center",
            cursor: media ? "default" : "pointer", transition: "all 0.15s",
            background: dragOver ? "#e8f4fb" : "#f8f9fa",
            position: "relative"
          }}>
          <input ref={fileInputRef} type="file" accept="image/*,video/*" style={{ display: "none" }} onChange={e => handleFile(e.target.files[0])} />
          <Label style={{ textAlign: "left", marginBottom: 8 }}>Image or Video (optional)</Label>

          {!media ? (
            <div style={{ ...mono, fontSize: 12, color: "#9ca3af" }}>
              <div style={{ fontSize: 22, marginBottom: 6 }}>üñºÔ∏è</div>
              <div>Drop or click to attach an image / video</div>
              <div style={{ fontSize: 10, marginTop: 4 }}>jpg ¬∑ png ¬∑ gif ¬∑ webp ¬∑ mp4 ¬∑ mov</div>
            </div>
          ) : media.type === "image" ? (
            <div style={{ position: "relative", display: "inline-block" }}>
              <img src={media.previewUrl} alt="" style={{ maxHeight: 180, maxWidth: "100%", borderRadius: 7, border: "1px solid #e5e7eb", objectFit: "contain" }} />
              <span style={{ position: "absolute", top: 6, left: 6, background: "#dcfce7", color: "#15803d", border: "1px solid #bbf7d0", ...mono, fontSize: 10, padding: "2px 7px", borderRadius: 20 }}>üñº Image</span>
              <button onClick={(e) => { e.stopPropagation(); setMedia(null); }} style={{ position: "absolute", top: 5, right: 5, background: "white", border: "1px solid #d1d5db", color: "#6b7280", width: 22, height: 22, borderRadius: "50%", cursor: "pointer", fontSize: 10, display: "flex", alignItems: "center", justifyContent: "center" }}>‚úï</button>
            </div>
          ) : (
            <div style={{ position: "relative", display: "inline-block" }}>
              <div style={{ background: "white", border: "1px solid #e5e7eb", borderRadius: 8, padding: "1.25rem 1.5rem", display: "flex", flexDirection: "column", alignItems: "center", gap: 5 }}>
                <span style={{ fontSize: 28 }}>üé¨</span>
                <div style={{ ...mono, fontSize: 12, color: "#0f172a", maxWidth: 220, overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>{media.fileName}</div>
                <div style={{ ...mono, fontSize: 11, color: "#9ca3af" }}>Video detected ‚Äî reach advice will be adapted</div>
              </div>
              <span style={{ position: "absolute", top: 6, left: 6, background: "#fff7ed", color: "#c2410c", border: "1px solid #fed7aa", ...mono, fontSize: 10, padding: "2px 7px", borderRadius: 20 }}>üìπ Video</span>
              <button onClick={(e) => { e.stopPropagation(); setMedia(null); }} style={{ position: "absolute", top: 5, right: 5, background: "white", border: "1px solid #d1d5db", color: "#6b7280", width: 22, height: 22, borderRadius: "50%", cursor: "pointer", fontSize: 10, display: "flex", alignItems: "center", justifyContent: "center" }}>‚úï</button>
            </div>
          )}
        </div>

        {/* Profile context accordion */}
        <div style={{ border: "1px solid #e5e7eb", borderRadius: 10, marginBottom: 10, overflow: "hidden", background: "#f8f9fa" }}>
          <div
            onClick={() => setProfileOpen(o => !o)}
            style={{ padding: "12px 16px", cursor: "pointer", display: "flex", alignItems: "center", gap: 8, ...mono, fontSize: 12, color: "#374151" }}>
            <span>üë§</span>
            <span>Your LinkedIn profile context</span>
            <span style={{ ...mono, fontSize: 10, color: "#9ca3af" }}>(optional ‚Äî improves accuracy)</span>
            <span style={{ marginLeft: "auto", color: "#9ca3af", fontSize: 10, transition: "transform 0.2s", display: "inline-block", transform: profileOpen ? "rotate(180deg)" : "none" }}>‚ñº</span>
          </div>
          {profileOpen && (
            <div style={{ borderTop: "1px solid #e5e7eb", padding: "14px 16px", background: "#fff" }}>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12, marginBottom: 12 }}>
                <div>
                  <Label>Followers count</Label>
                  <input type="number" value={followers} onChange={e => setFollowers(e.target.value)} placeholder="e.g. 2400" style={inputStyle} />
                </div>
                <div>
                  <Label>Your role at EF</Label>
                  <select value={role} onChange={e => setRole(e.target.value)} style={inputStyle}>
                    <option value="">Select role‚Ä¶</option>
                    <option value="Talent Investor (TI)">Talent Investor (TI)</option>
                    <option value="General Manager (GM)">General Manager (GM)</option>
                    <option value="EF Founder / Alumni">Founder / EF Alumni</option>
                    <option value="Partner">Partner</option>
                    <option value="Operations / Community">Operations / Community</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div>
                  <Label>Primary audience</Label>
                  <select value={audience} onChange={e => setAudience(e.target.value)} style={inputStyle}>
                    <option value="">Select audience‚Ä¶</option>
                    <option value="European tech talent and aspiring founders">European tech talent / aspiring founders</option>
                    <option value="Early-stage founders and cofounders">Early-stage founders</option>
                    <option value="VCs and investors">VCs & investors</option>
                    <option value="Tech professionals and engineers">Tech professionals</option>
                    <option value="Startup ecosystem broadly">Startup ecosystem broadly</option>
                  </select>
                </div>
                <div>
                  <Label>EF city</Label>
                  <select value={cohort} onChange={e => setCohort(e.target.value)} style={inputStyle}>
                    <option value="">Select city‚Ä¶</option>
                    <option value="Paris">Paris</option>
                    <option value="London">London</option>
                    <option value="Berlin">Berlin</option>
                    <option value="Singapore">Singapore</option>
                    <option value="New York">New York</option>
                    <option value="Global / Remote">Global / Remote</option>
                  </select>
                </div>
              </div>
              <div>
                <Label>Your content niche (optional)</Label>
                <input type="text" value={niche} onChange={e => setNiche(e.target.value)} placeholder="e.g. cofounder matching, deep tech, European founders going to the US‚Ä¶" style={inputStyle} />
              </div>
            </div>
          )}
        </div>

        {/* Error */}
        {error && (
          <div style={{ background: "#fef2f2", border: "1px solid #fecaca", borderRadius: 8, padding: "10px 14px", color: "#dc2626", ...mono, fontSize: 12, marginBottom: 12 }}>
            {error}
          </div>
        )}

        {/* Analyze button */}
        <button
          onClick={analyze}
          disabled={loading}
          style={{
            width: "100%", padding: "13px", background: loading ? "#374151" : "#0f172a", border: "none",
            borderRadius: 10, color: "white", fontFamily: "'Syne', sans-serif", fontSize: 14, fontWeight: 700,
            cursor: loading ? "not-allowed" : "pointer", display: "flex", alignItems: "center", justifyContent: "center",
            gap: 8, marginBottom: "2rem", letterSpacing: 0.2, transition: "all 0.15s",
            opacity: loading ? 0.8 : 1
          }}>
          {loading ? (
            <>
              <div style={{ width: 15, height: 15, border: "2px solid rgba(255,255,255,0.3)", borderTopColor: "white", borderRadius: "50%", animation: "spin 0.7s linear infinite" }} />
              Analyzing‚Ä¶
            </>
          ) : "‚ö° Analyze Post"}
        </button>

        {/* Results */}
        {result && (
          <div style={{ animation: "fadeUp 0.3s ease" }}>
            <Divider label="Analysis Results" />

            {/* Overall verdict */}
            <Card style={{ background: "#f8f9fa" }}>
              <div style={{ display: "flex", alignItems: "flex-end", gap: 20, marginBottom: 12, flexWrap: "wrap" }}>
                <div>
                  <div style={{ fontSize: 48, fontWeight: 800, lineHeight: 1, color: GRADE_COLOR[result.overall_score] || "#0f172a" }}>{result.overall_score}</div>
                  <div style={{ ...mono, fontSize: 9, color: "#9ca3af", textTransform: "uppercase", letterSpacing: 1 }}>Overall Score</div>
                </div>
                <div>
                  <Label>Post type</Label>
                  <div style={{ fontWeight: 700, fontSize: 14 }}>{result.post_type}</div>
                </div>
                <div style={{ flex: 1, minWidth: 140 }}>
                  <Label>Target audience</Label>
                  <div style={{ fontWeight: 600, fontSize: 13, color: "#374151" }}>{result.target_audience}</div>
                </div>
              </div>
              <p style={{ fontSize: 13.5, lineHeight: 1.65, color: "#374151" }}>{result.verdict}</p>
            </Card>

            {/* Score breakdown */}
            <Divider label="Score Breakdown" />
            <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 10, marginBottom: 20 }}>
              {Object.values(result.scores || {}).map((s, i) => (
                <div key={i} style={{ background: "#f8f9fa", border: "1px solid #e5e7eb", borderRadius: 10, padding: "14px 12px", textAlign: "center" }}>
                  <div style={{ fontSize: 26, fontWeight: 800, lineHeight: 1, marginBottom: 5, color: GRADE_COLOR[s.grade] || "#9ca3af" }}>{s.grade}</div>
                  <div style={{ ...mono, fontSize: 10, color: "#9ca3af", textTransform: "uppercase", letterSpacing: "0.5px" }}>{s.label}</div>
                </div>
              ))}
            </div>

            {/* Expected performance */}
            <div style={{ border: "1px solid #e5e7eb", borderRadius: 10, padding: "1.1rem 1.25rem", background: "#fff", marginBottom: 10 }}>
              <div style={{ ...mono, fontSize: 10, textTransform: "uppercase", letterSpacing: "1px", color: "#9ca3af", marginBottom: 12, display: "flex", alignItems: "center", gap: 5 }}>
                <span>üìä</span>Expected Performance
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16 }}>
                {[
                  { label: "Impressions", val: result.expected_impressions, sub: "organic reach" },
                  { label: "Engagement Rate", val: result.expected_engagement_rate, sub: "avg: 3.85%" },
                  { label: "Comments", val: result.expected_comments, sub: "est. replies" },
                  { label: "Shares", val: result.expected_shares, sub: "amplification" },
                ].map((m, i) => (
                  <div key={i}>
                    <div style={{ ...mono, fontSize: 10, textTransform: "uppercase", letterSpacing: "0.5px", color: "#9ca3af", marginBottom: 3 }}>{m.label}</div>
                    <div style={{ fontSize: 18, fontWeight: 700, color: "#0077b5" }}>{m.val}</div>
                    <div style={{ ...mono, fontSize: 11, color: "#9ca3af", marginTop: 1 }}>{m.sub}</div>
                  </div>
                ))}
              </div>
            </div>

            {/* Feedback divider */}
            <Divider label="Feedback" />

            {/* Double column */}
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 10 }}>
              {/* Left: What's Working */}
              <div style={{ border: "1px solid #e5e7eb", borderRadius: 10, padding: "1.1rem 1.25rem", background: "#fff" }}>
                <CardTitle icon="‚úÖ">What's Working</CardTitle>
                <PointList items={[
                  ...(result.pros || []),
                  ...(result.visual?.suggestion && result.visual?.media_type !== "none" ? ["Visual: " + result.visual.suggestion] : [])
                ]} type="good" />
              </div>

              {/* Right: What to Change + Algorithm Killers */}
              <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                <div style={{ border: "1px solid #e5e7eb", borderRadius: 10, padding: "1.1rem 1.25rem", background: "#fff" }}>
                  <CardTitle icon="üîß">What to Change</CardTitle>
                  <PointList items={[
                    ...(result.cons || []),
                    ...(result.visual?.suggestion && result.visual?.media_type === "none" ? ["Visual: " + result.visual.suggestion] : [])
                  ]} type="bad" />
                </div>
                {result.red_flags?.length > 0 && (
                  <div style={{ border: "1px solid #fecaca", borderRadius: 10, padding: "1.1rem 1.25rem", background: "#fef2f2" }}>
                    <CardTitle icon="üö®" color="#dc2626">Algorithm Killers</CardTitle>
                    <PointList items={result.red_flags} type="bad" />
                  </div>
                )}
              </div>
            </div>

            {/* Hook rewrite */}
            <Divider label="Hook Rewrite" />
            <Card>
              <CardTitle icon="‚úçÔ∏è">Suggested Hook</CardTitle>
              <div style={{ background: "#f8f9fa", border: "1px solid #e5e7eb", borderRadius: 8, padding: "14px 16px", position: "relative" }}>
                <button
                  onClick={copyHook}
                  style={{ position: "absolute", top: 9, right: 9, background: "white", border: "1px solid #e5e7eb", color: "#9ca3af", ...mono, fontSize: 10, padding: "3px 9px", borderRadius: 5, cursor: "pointer" }}>
                  {copied ? "Copied!" : "Copy"}
                </button>
                <p style={{ ...mono, fontSize: 13, lineHeight: 1.7, color: "#0f172a", whiteSpace: "pre-wrap", paddingRight: 60 }}>{result.hook_rewrite}</p>
              </div>
            </Card>

            {/* Posting strategy ‚Äî bullets */}
            <Divider label="Posting Strategy" />
            <Card>
              <CardTitle icon="üïê">When & How to Post</CardTitle>
              <ul style={{ listStyle: "none", display: "flex", flexDirection: "column", gap: 6 }}>
                {(result.posting_strategy || "")
                  .split(/(?<=[.!])\s+/)
                  .filter(s => s.trim().length > 4)
                  .map((s, i) => (
                    <li key={i} style={{ display: "flex", gap: 10, alignItems: "flex-start" }}>
                      <span style={{ color: "#0077b5", fontWeight: 700, fontSize: 13, lineHeight: 1.5, flexShrink: 0 }}>‚Äî</span>
                      <span style={{ fontSize: 13, color: "#374151", lineHeight: 1.55 }}>{s.trim()}</span>
                    </li>
                  ))}
              </ul>
            </Card>

            {/* Hashtags */}
            <Divider label="Hashtags" />
            <Card>
              <div style={{ display: "flex", alignItems: "center", gap: 12, flexWrap: "wrap" }}>
                <div>{(result.hashtags || []).map((h, i) => <Tag key={i} color="blue">#{h.replace("#", "")}</Tag>)}</div>
                <p style={{ fontSize: 11.5, color: "#9ca3af", ...mono, lineHeight: 1.5 }}>{result.hashtag_tip}</p>
              </div>
            </Card>
          </div>
        )}
      </div>
    </div>
  );
}
